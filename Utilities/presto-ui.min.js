"use strict";function Ctrl(n){n.timestamp="2012-09-06 22:21:15";n.loadtime=(new Date).getTime();n.fiddletime="2012-09-06 22:21:15"}prestoApp.config(["$httpProvider",function(n){var t={getModuleId:function(){return angular.isDefined($.dnnSF)?sf.getModuleId():-1},getTabId:function(){return angular.isDefined($.dnnSF)?sf.getTabId():-1},getTabModuleId:function(){var n=-1;try{angular.isDefined(tabModuleId)&&(n=tabModuleId)}catch(t){}return n},getAntiForgeryValue:function(){return angular.isDefined($.dnnSF)?sf.getAntiForgeryValue():-1}};n.defaults.headers.common.ModuleId=t.getModuleId();n.defaults.headers.common.TabId=t.getTabId();n.defaults.headers.common.tabModuleId=t.getTabModuleId();n.defaults.headers.common.__RequestVerificationToken=t.getAntiForgeryValue();n.responseInterceptors.push("globalHttpInterceptor")}]);prestoApp.factory("globalHttpInterceptor",["$q","$window","messageService",function(n,t,i){return function(r){return r.then(function(n){return n},function(r){var u=r.status;return u===0?i.publish("evt::user.notification",{type:"error",autoDelete:!1,message:"Oops, a connectivity problem has occurred, try again later."}):u===401?t.location.href="/":u===403?i.publish("evt::user.notification",{type:"error",autoDelete:!1,message:r.data.error.userMessage}):u===404?i.publish("evt::user.notification",{type:"error",autoDelete:!1,message:"Sorry, that item could not be found."}):u===500&&i.publish("evt::user.notification",{type:"error",autoDelete:!1,message:r.data.error.userMessage}),n.reject(r)})}}]);prestoApp.factory("messageService",["$rootScope",function(n){var t=n;return{publish:function(n,i){t.$emit(n,i)},subscribe:function(n,i){t.$on(n,i)}}}]);prestoApp.factory("sstsService",["$http","$q","config",function(n,t,i){return{getSections:function(){var r=t.defer(),u=i.baseApiUrl+"sites/"+i.currentSiteId+"/ssts";return n.get(u).success(function(n){r.resolve(n)}).error(function(n){r.reject(n)}),r.promise},getSubsections:function(r){var u=t.defer(),f;return r==""?u.resolve([]):(f=i.baseApiUrl+"sites/"+i.currentSiteId+"/ssts/"+r,n.get(f).success(function(n){u.resolve(n)}).error(function(n){u.reject(n)})),u.promise},getTopics:function(r,u){var f=t.defer(),e;return r==""||u==""?f.resolve([]):(e=i.baseApiUrl+"sites/"+i.currentSiteId+"/ssts/"+r+"/"+u,n.get(e).success(function(n){f.resolve(n)}).error(function(n){f.reject(n)})),f.promise},getSubtopics:function(r,u,f){var e=t.defer(),o;return r==""||u==""||f==""?e.resolve([]):(o=i.baseApiUrl+"sites/"+i.currentSiteId+"/ssts/"+r+"/"+u+"/"+f,n.get(o).success(function(n){e.resolve(n)}).error(function(n){e.reject(n)})),e.promise}}}]);prestoApp.directive("affix",["$window","$document","$parse",function(n){return{scope:{affix:"&"},transclude:!0,link:function(t,i){function f(){var f=t.affix(),n=r.prop("pageYOffset")<=f?"affix-top":"affix";u!==n&&(u=n,i.removeClass("affix affix-top").addClass(n))}var r=angular.element(n),u;r.bind("scroll",f);r.bind("click",function(){setTimeout(f,1)})}}}]);prestoApp.factory("searchService",["$resource","config",function(n,t){return n(t.baseApiUrl+"PrestoSearch")}]);prestoApp.directive("assetBullet",function(n){return{restrict:"E",transclude:!0,replace:!1,scope:{asset:"="},link:function(t,i,r){var e=r.mode||"standalone",u='<span type="button" class="btn btn-mini asset-bullet">ID <input type="text" value="{{asset.id}}" select-on-click /><\/span><button type="button" class="btn btn-mini dropdown-toggle" data-toggle="dropdown"><span class="caret"><\/span><\/button><ul class="dropdown-menu asset-bullet-dropdown"><li ng-repeat="item in asset.actions"><a href="{{item.pathTemplate}}" target="_blank">{{item.caption}}<\/a><\/li><\/ul>',f=u;e=="standalone"&&(f='<div class="btn-group  metalinks" >'+u+"<\/div>");i.replaceWith(n(f)(t))}}});prestoApp.directive("assetPanel",function(){return{restrict:"E",replace:!1,scope:{options:"="},templateUrl:"/desktopmodules/udmw/utilities/presto-ui/templates/AssetPanel.tpl.html",controller:function(n,t,i){n.name="assetPanel.controller";n.searchResults=[];n.draggable={options:{effectAllowed:"move",itemType:"Text"}};n.addToClicked=function(t){if(n.options.addToHandler){var i=angular.copy(n.searchResults[t]);n.options.addToHandler(i);n.searchResults.splice(t,1)}};n.search=function(t){angular.isDefined(t)||(t="");n.isSendRequest=!0;n.searchResults=[];n.noSearchResults=!1;n.noSearchTerm="";i.query({searchTerm:t,assetTypeFilter:n.options.searchAssetTypeFilter,onlyPublishedAssets:n.options.onlyPublishedAssets},function(i){n.options.excludeFromResults?(angular.forEach(i,function(t){n.options.excludeFromResults(t.id)==!1&&n.searchResults.push(t)}),n.searchResults.length<1?(n.noSearchResults=!0,n.noSearchTerm=t):n.noSearchResults=!1):n.searchResults=i;n.isSendRequest=!1},function(){console.log("error while searching "+n.searchTerm);n.isSendRequest=!1})};n.onDragEnded=function(t,i){i!="none"&&n.$apply(function(){n.searchResults.splice(t,1)})}}}});prestoApp.directive("draggable",[function(){return{restrict:"A",link:function(n,t,i){var r=t,u=n.$eval(i.draggableOptions),f=n.$eval(i.draggableDragEnded),e={onDragStart:function(t){var f,e,o;r.addClass("dragging");f=t.originalEvent!=null?t.originalEvent.dataTransfer:t.dataTransfer;f.effectAllowed=u.effectAllowed;e={target:n.$eval(i.draggableModel),originalKey:n.$eval(i.draggableKey)};o=angular.toJson(e);f.setData(u.itemType,o)},onDragEnd:function(t){if(t.preventDefault&&t.preventDefault(),r.removeClass("dragging"),f){var u=t.originalEvent!=null?t.originalEvent.dataTransfer:t.dataTransfer,e=n.$eval(i.draggableKey);f(e,u.dropEffect)}}};t.attr("draggable","true");t.bind("dragstart",e.onDragStart);t.bind("dragend",e.onDragEnd)}}}]);prestoApp.directive("droppable",[function(){return{restrict:"A",link:function(n,t,i){var r=t,u=n.$eval(i.droppableOptions),e=function(n){return u.typesAllowed.indexOf(n)!=-1?!0:!1},o=function(n){for(var t=0;t<u.typesAllowed.length;t++)if(angular.isFunction(n.types.indexOf)){if(n.types.indexOf(u.typesAllowed[t])!=-1)return u.typesAllowed[t]}else if(n.types.contains(u.typesAllowed[t]))return u.typesAllowed[t];return-1},f={onDropleave:function(n){var t=n.originalEvent!=null?n.originalEvent.dataTransfer:n.dataTransfer;t.dropEffect="none";r.removeClass("drag-over-top");r.removeClass("drag-over-bottom")},onDragEnter:function(n){n.preventDefault&&n.preventDefault();var t=n.originalEvent!=null?n.originalEvent.dataTransfer:n.dataTransfer;e(t.types[0])&&(t.dropEffect=i.dropzone)},onDragOver:function(n){var t,u;return(n.preventDefault&&n.preventDefault(),r.removeClass("drag-over-top"),r.removeClass("drag-over-bottom"),t=n.originalEvent!=null?n.originalEvent.dataTransfer:n.dataTransfer,e(t.types[0]))?(u=r.height()/2,n.originalEvent.offsetY>u?r.addClass("drag-over-bottom"):r.addClass("drag-over-top"),t.dropEffect=i.dropzone,!1):!0},onDropped:function(t){var u,f,e,s,h,c;if(t.stopPropagation&&t.stopPropagation(),u=t.originalEvent!=null?t.originalEvent.dataTransfer:t.dataTransfer,u.dropEffect=i.dropzone,f="bottom",r.hasClass("drag-over-top")&&(f="top"),r.removeClass("drag-over-top"),r.removeClass("drag-over-bottom"),e=n.$eval(i.afterDropped),e){if(s=o(u),s==-1)return console.error("something went wrong finding the datakey for the drag/drop: "),!0;if(h=u.getData(s),h)return c={source:angular.fromJson(h),targetDirection:f,targetScope:n},e(c,u.dropEffect),!1}return!0}};t.bind("dragenter",f.onDragEnter);t.bind("dragover",f.onDragOver);t.bind("dragleave",f.onDropleave);t.bind("drop",f.onDropped)}}}]);prestoApp.directive("fadeIn",function(){return{restrict:"A",compile:function(n){return $(n).css("opacity",0),function(n,t,i){var r;r=parseInt(i.dfFadeIn,10);isNaN(r)&&(r=500);$(t).animate({opacity:1},r)}}}});prestoApp.directive("focusNextOnClick",function(n){return{link:function(t,i){i.bind("click",function(){n(function(){i.next()[0].focus()})})}}});prestoApp.directive("notificationBar",function(){return{restrict:"E",controller:function(n,t,i){i.subscribe("evt::user.notification",function(n,i){$.bootstrapGrowl(i.message,{ele:t,type:i.type,offset:{from:"top",amount:-11},align:"center",width:"auto",delay:i.autoDelete?3e3:0,allow_dismiss:!0,stackup_spacing:10})})}}});prestoApp.directive("remainingCharacters",function(){return{template:'<strong  class="small">{{remaining}}<\/strong> / {{maxLen}}',scope:{maxLen:"=maxlength",model:"=ngModel"},link:function(n){var t=function(t){var i=parseInt(n.maxLen,10),r;if(!angular.isDefined(t)||!angular.isString(t)){n.remaining=i;return}r=i-t.length;r<0?n.model=t.substr(0,i):n.remaining=r};n.$watch("model",function(n){t(n)})}}});prestoApp.directive("heightEquals",[function(){return{restrict:"A",link:function(n,t,i){setTimeout(function(){var u=$(i.heightEquals).height(),n=0,f=i.autoHeight,r=u-n;i.expandable&&(f=i.expandable);i.offsetHeight&&(n=i.offsetHeight,n!=0&&(r=parseInt(u)+parseInt(n)));f==!0?$(t).css("min-height",r):$(t).height(r)},1e3)}}}]);prestoApp.directive("sstsControls",["sstsService",function(n){return{restrict:"E",replace:!1,transclude:!0,scope:{sstsModel:"=",options:"="},templateUrl:"/desktopmodules/udmw/utilities/presto-ui/templates/SstsControls.tpl.html",link:function(t){t.name="sstsControls";t.clearWatch=!1;t.data={sections:[],subsections:[],topics:[],subtopics:[]};var i=function(i){n.getSubsections(i.section).then(function(r){return t.data.subsections=r,n.getTopics(i.section,i.subsection)}).then(function(r){return t.data.topics=r,n.getSubtopics(i.section,i.subsection,i.topic)}).then(function(n){t.data.subtopics=n;t.validate();t.clearWatch=!1})};t.$watch("sstsModel",function(n,r){t.clearWatch!=!0&&angular.isDefined(n)&&(n.section!=""||n.subsection!=""||n.topic!=""||n.subtopic!="")&&(t.clearWatch=!0,n.section!=r.section&&r.section!=""&&(console.log("section changed"),t.sstsModel.subsection="",t.sstsModel.topic="",t.sstsModel.subtopic=""),n.subsection!=r.subsection&&r.subsection!=""&&(console.log("subsection changed"),t.sstsModel.topic="",t.sstsModel.subtopic=""),n.topic!=r.topic&&r.topic!=""&&(console.log("topic changed"),t.sstsModel.subtopic=""),i(n))},!0);n.getSections().then(function(n){t.data.sections=n});t.validate=function(){return t.options.isValid=t.sstsModel.section!="",t.options.isValid};t.options.canPublish=function(){return t.validate()};t.options.canSaveDraft=function(){t.options.isValid=!0}}}}]);prestoApp.directive("selectOnClick",function(){return function(n,t){t.bind("click",function(){t.select()})}});angular.module("ui.keypress",[]).factory("keypressHelper",["$parse",function(n){var t={8:"backspace",9:"tab",13:"enter",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete"},i=function(n){return n.charAt(0).toUpperCase()+n.slice(1)};return function(r,u,f,e){var o,s=[];o=u.$eval(e["ui"+i(r)]);angular.forEach(o,function(t,i){var r,u;u=n(t);angular.forEach(i.split(" "),function(n){r={expression:u,keys:{}};angular.forEach(n.split("-"),function(n){r.keys[n]=!0});s.push(r)})});f.bind(r,function(n){var e=!!(n.metaKey&&!n.ctrlKey),o=!!n.altKey,h=!!n.ctrlKey,f=!!n.shiftKey,i=n.keyCode;r==="keypress"&&!f&&i>=97&&i<=122&&(i=i-32);angular.forEach(s,function(r){var s=r.keys[t[i]]||r.keys[i.toString()],c=!!r.keys.meta,l=!!r.keys.alt,a=!!r.keys.ctrl,v=!!r.keys.shift;s&&c===e&&l===o&&a===h&&v===f&&u.$apply(function(){r.expression(u,{$event:n})})})})}}]);angular.module("ui.keypress").directive("uiKeydown",["keypressHelper",function(n){return{link:function(t,i,r){n("keydown",t,i,r)}}}]);angular.module("ui.keypress").directive("uiKeypress",["keypressHelper",function(n){return{link:function(t,i,r){n("keypress",t,i,r)}}}]);angular.module("ui.keypress").directive("uiKeyup",["keypressHelper",function(n){return{link:function(t,i,r){n("keyup",t,i,r)}}}]);prestoApp.directive("mediaBullet",function(){return{restrict:"E",replace:!1,scope:{options:"="},templateUrl:"/desktopmodules/udmw/utilities/presto-ui/templates/MediaBullet.tpl.html"}});prestoApp.directive("timer",function(n){return{restrict:"E",replace:!1,scope:{interval:"@",countdown:"@",hadExpiration:"@",statusCode:"@"},link:function(n){n.$watch("countdown",function(t){t.length&&n.start()})},controller:function(t,i){function u(){t.timeoutId&&n.cancel(t.timeoutId)}t.startTime=null;t.timeoutId=null;t.countdown=t.countdown&&parseInt(t.countdown,10)>0?parseInt(t.countdown,10):undefined;t.status="not-started";t.canShowCountDownLabel=function(){return t.statusCode!="200"?!1:t.status=="running"?!0:!1};t.canShowExpirationLabel=function(){return t.statusCode!="200"?!1:t.status=="ended"||t.hadExpiration=="true"&&t.status=="not-started"?!0:!1};t.start=i[0].start=function(){t.startTime=new Date;u();r()};t.stop=i[0].stop=function(){t.stoppedTime=new Date;n.cancel(t.timeoutId);t.timeoutId=null};i.bind("$destroy",function(){n.cancel(t.timeoutId)});var r=function(){if(t.countdown>0){t.countdown--;t.millis=t.countdown*1e3;t.seconds=Math.floor(t.millis/1e3%60);t.minutes=Math.floor(t.millis/6e4%60);t.hours=Math.floor(t.millis/36e5%24);var i=t.hours>0?t.hours.toString():0;i+=t.minutes<10?":0"+t.minutes.toString():":"+t.minutes.toString();i+=t.seconds<10?":0"+t.seconds.toString():":"+t.seconds.toString();t.display=i;t.timeoutId=n(function(){r()},t.interval);t.status="running"}else t.countdown<=0&&(t.status=="running"&&(t.status="ended"),t.stop())};t.start()}}});prestoApp.filter("timeago",function(){return function(n,t){var r=function(n,t,i){var r=$.isFunction(n)?n(t,s):n,u=i.numbers&&i.numbers[t]||t;return r.replace(/%d/i,u)},v=(new Date).getTime(),y=new Date(n).getTime(),p=t||!1,i={prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"< 1 min",minute:"%d min",minutes:"%d mins",hour:"%d hr",hours:"%d hrs",day:"%d day",days:"%d days",month:"%d mth",months:"%d mths",year:"%d yr",years:"%d yrs"},s=v-y,h,f=Math.abs(s)/1e3,e=f/60,o=e/60,u=o/24,c=u/365,w=i.wordSeparator===undefined?" ":i.wordSeparator,l=i.prefixAgo,a=i.suffixAgo;return p&&s<0&&(l=i.prefixFromNow,a=i.suffixFromNow),h=f<45&&r(i.seconds,Math.round(f),i)||f<90&&r(i.minute,1,i)||e<45&&r(i.minutes,Math.round(e),i)||e<90&&r(i.hour,1,i)||o<24&&r(i.hours,Math.round(o),i)||o<42&&r(i.day,1,i)||u<30&&r(i.days,Math.round(u),i)||u<45&&r(i.month,1,i)||u<365&&r(i.months,Math.round(u/30),i)||c<1.5&&r(i.year,1,i)||r(i.years,Math.round(c),i),$.trim([l,h,a].join(w))}});prestoApp.filter("runtime",function(){return function(n){function t(n){return(n<10?"0":"")+n}function i(n){var i=Math.floor(n%31536e3/86400),r=Math.floor(n%31536e6%86400/3600),u=Math.floor(n%31536e6%86400%3600/60);return t(i)+":"+t(r)+":"+t(u)}return n==0?"00:00:00":i(n)}});prestoApp.directive("siteGroupSelector",function(){return{restrict:"E",transclude:!0,replace:!1,templateUrl:"/desktopmodules/udmw/utilities/presto-ui/templates/siteGroupSelector.tpl.html",controller:function(n){n.hideRecentSiteGroups=!1;n.showSiteGroups=!0;n.recentSiteGroups=[{id:"7890",name:"Daily Record"},{id:"0123",name:"The Daily Journal"},{id:"3456",name:"Asbury Park Press"}];n.siteGroups={recentSiteGroups:n.recentSiteGroups,allAvailableSiteGroups:[{id:"1234",name:"My Central Jersey"},{id:"4567",name:"Courier Post"},{id:"7890",name:"Daily Record"},{id:"0123",name:"The Daily Journal"},{id:"3456",name:"Asbury Park Press"}]};n.selected=n.siteGroups.allAvailableSiteGroups[0];n.siteGroups.allAvailableSiteGroups.length<=1&&n.recentSiteGroups.length<=1&&(n.showSiteGroups=!1);n.recentSiteGroups.length>1&&(n.hideRecentSiteGroups=!0);n.selectSite=function(t){n.selected=t}},link:function(){}}});prestoApp.directive("assetInUseSignalr",function(){return{restrict:"E",replace:!1,scope:{options:"="},template:'<div id="signalRUsersContainer" class="alert" ng-show="showContainer"><small><span>In Use By:&nbsp;<\/span><span id="signalRUsers">{{users}}<\/span><\/small><\/span><\/div>',controller:function(n,t){n.name="assetInUseSignalr.controller";n.showContainer=!1;n.users="";t.id!=null&&t.id.length>0&&(InUse.signalR.groupId="Asset"+t.id,InUse.signalR.displayName=$('a[id*="registerLink"]').html().trim(),InUse.signalR.userIn($.connection));n.showSignalRContainer=function(t){n.$apply(function(){n.users=t;n.showContainer=t.length>0?!0:!1})};n.updateUsers=function(t){t=t.split(",");var i=InUse.signalR.getUniqueUsernames(t);n.showSignalRContainer(i)};$.connection.inUseHub.client.updateUsers=function(t){n.updateUsers(t)}}}});